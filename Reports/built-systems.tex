%
% ---- Built systems
%

\section{Built systems}

Reference to github at \cite{RN1073}

General design decisions:

Cassandra \cite{RN1050}\cite{RN1075} database.  Create a Dbstress program and measured throughput of Cassandra node at 130 queries per second.

Measurement using Coda Hale Metrics \cite{RN1079}.

Load testing using Apache JMeter \cite{RN1074}.

%
% ---- Simple microservices
%
\subsection{Simple microservices}

RESTful APIs using Java Spring \cite{RN1076}.

Implemented a \\control API which doesn't access the database.

Use JMeter with Poisson random timer (negative exponential distribution) with Cycling at a constant 10 threads/users and Athletics ramping up from 10-100 in steps of 10, so the desired demand is 20-200 requests per second.

Run the experiment 5 times and average the results (taking the maximum rolling 1 minute average for each number of users).

See the experimental results in Table \ref{table:builtmicro_results}.

Control shows that throughput approaches demand (difference likely to be due to random distribution, network latency, etc).  However the Athletics demand is throttled by the database throughput.  The Cycling throughput is unaffected by the Athletics demand. 

\begin{table}[h!]
	\begin{center}
		\caption{Simple microservices experimental results}
		\label{table:builtmicro_results}
		\pgfplotstabletypeset[
		col sep=comma,
		string type,
		columns/ausers/.style={column name=users, column type={p{.1\textwidth}}},
		columns/arate/.style={column name=rate, column type={p{.1\textwidth}}},
		columns/athletics/.style={column name=search, column type={p{.1\textwidth}}},
		columns/acontrol/.style={column name=control, column type={p{.1\textwidth}}},
		columns/cusers/.style={column name=users, column type={p{.1\textwidth}}},
		columns/crate/.style={column name=rate, column type={p{.1\textwidth}}},
		columns/cycling/.style={column name=search, column type={p{.1\textwidth}}},
		columns/ccontrol/.style={column name=control, column type={p{.1\textwidth}}},
		every head row/.style={before row=\hline \multicolumn{4}{c}{Athletics} & \multicolumn{4}{c}{Cycling} \\,after row=\hline},
		every last row/.style={after row=\hline},
		]{data/builtmicro/results.csv}
	\end{center}
\end{table}

\begin{figure}
	\caption{Simple microservices experimental results}
	\label{figure:builtmicro_charts}
	\centering
	\begin{tikzpicture}
	\begin{axis}[
	title={Throughput against athletics demand},
	xlabel={Athletics demand},
	ylabel={Throughput},
	xmin=0, xmax=200,
	ymin=0, ymax=150,
	legend pos=north west,
	ymajorgrids=true,
	grid style=dashed,
	cycle multiindex* list={
		mark list*
		\nextlist
		cyan,brown,green,blue,red
	}
	]
	
	\addplot table [x index={1}, y index={2}, col sep=comma]{data/builtmicro/results.csv};
	\addplot table [x index={1}, y index={6}, col sep=comma]{data/builtmicro/results.csv};
	
	\legend{athletics,cycling}
	
	\end{axis}
	\end{tikzpicture}
\end{figure}

%
% ---- Shared queue middleware
%
\subsection{Shared queue middleware}

See the experimental results in Table \ref{table:builtddnr_results}.

\begin{table}[h!]
	\begin{center}
		\caption{Shared queue with distributed DB experimental results}
		\label{table:builtddnr_results}
		\pgfplotstabletypeset[
		col sep=comma,
		string type,
		columns/conusers/.style={column name=users, column type={p{.1\textwidth}}},
		columns/conrate/.style={column name=rate, column type={p{.1\textwidth}}},
		columns/ausers/.style={column name=users, column type={p{.1\textwidth}}},
		columns/arate/.style={column name=rate, column type={p{.1\textwidth}}},
		columns/cusers/.style={column name=users, column type={p{.1\textwidth}}},
		columns/crate/.style={column name=rate, column type={p{.1\textwidth}}},
		columns/db1/.style={column name=db1, column type={p{.1\textwidth}}},
		columns/db2/.style={column name=db2, column type={p{.1\textwidth}}},
		every head row/.style={before row=\hline \multicolumn{2}{c}{Control} &
		\multicolumn{2}{c}{Athletics} & \multicolumn{2}{c}{Cycling} &
		\multicolumn{2}{c}{Database} \\,after row=\hline},
		every last row/.style={after row=\hline},
		]{data/builtddnr/results.csv}
	\end{center}
\end{table}

\begin{figure}
	\caption{Shared queue with distributed DB experimental results}
	\label{figure:builtddnr_charts}
	\centering
	\begin{tikzpicture}
	\begin{axis}[
	title={Throughput against athletics demand},
	xlabel={Athletics demand},
	ylabel={Throughput},
	xmin=0, xmax=150,
	ymin=0, ymax=1000,
	legend pos=north west,
	ymajorgrids=true,
	grid style=dashed,
	cycle multiindex* list={
		mark list*
		\nextlist
		cyan,brown,green,blue,red
	}
	]

	\addplot table [x index={2}, y index={3}, col sep=comma]{data/builtddnr/results.csv};
	\addplot table [x index={2}, y index={5}, col sep=comma]{data/builtddnr/results.csv};
	\addplot table [x index={2}, y index={1}, col sep=comma]{data/builtddnr/results.csv};
	
	\legend{athletics,cycling,control}
	
	\end{axis}
	\end{tikzpicture}
\end{figure}

%
% ---- Distributed database with replication
%
\subsection{Distributed database with replication}

