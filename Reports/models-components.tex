%
% ---- PEPA Component Models
%

\section{PEPA Component Models}

%
% ---- Distributed database without replication
%
\subsection{Distributed database without replication}

The PEPA model for a distributed database is shown in Figure \ref{figure:pepa_dd_model}.

\begin{figure}
	\caption{Distributed database PEPA model}
	\label{figure:pepa_dd_model}
	\centering
% Automatically generated by PEPA2Latex
% --begin
\begin{displaymath}
	\begin{array}{rcl}
		\mathit{a} & = & 1.0-10.0\\
		\mathit{c} & = & 1.0\\
		\mathit{db} & = & 5.0\\
		[0.0ex]		\mathit{Website} & \rmdef & (\mathit{book_a},\mathit{a}).\mathit{Website}+(\mathit{book_c},\mathit{c}).\mathit{Website}\\
		\mathit{DB_1} & \rmdef & (\mathit{book_a},\top).\mathit{DBsrv_1}\\
		\mathit{DBsrv_1} & \rmdef & (\mathit{dbsrv_1},\top).\mathit{DB_1}\\
		\mathit{DB_2} & \rmdef & (\mathit{book_c},\top).\mathit{DBsrv_2}\\
		\mathit{DBsrv_2} & \rmdef & (\mathit{dbsrv_2},\top).\mathit{DB_2}\\
		\mathit{Service_1} & \rmdef & (\mathit{dbsrv_1},\mathit{db}).\mathit{Service_1}\\
		\mathit{Service_2} & \rmdef & (\mathit{dbsrv_2},\mathit{db}).\mathit{Service_2}\\
		[0.0ex]		\multicolumn{3}{l}{\mathit{Website}\sync{book_a,book_c}\mathit{DB_1}\parallel\mathit{DB_2}\sync{dbsrv_1,dbsrv_2}\mathit{Service_1}\parallel\mathit{Service_2}}\\
		[0.0ex]	\end{array}
\end{displaymath}
% --end
\end{figure}

See the experimental results in Table \ref{table:dd_results}.

\begin{table}[h!]
	\begin{center}
		\caption{Distributed database experimental results}
		\label{table:dd_results}
			\pgfplotstabletypeset[
			col sep=comma,
			string type,
			columns/a/.style={column name=a, column type={p{.1\textwidth}}},
			columns/booka/.style={column name=book\textsubscript{a}, column type={p{.1\textwidth}}},
			columns/bookc/.style={column name=book\textsubscript{c}, column type={p{.1\textwidth}}},
			columns/dbsrv1/.style={column name=dbsrv\textsubscript{1}, column type={p{.1\textwidth}}},
			columns/dbsrv2/.style={column name=dbsrv\textsubscript{2}, column type={p{.1\textwidth}}},
			every head row/.style={before row=\hline Rate & \multicolumn{4}{c}{Throughput} \\,after row=\hline},
			every last row/.style={after row=\hline},
			]{data/ddnr/results.csv}
	\end{center}
\end{table}

\begin{figure}
	\caption{Distributed database experimental results}
	\label{figure:dd_charts}
	\centering
	\begin{tikzpicture}
	\begin{axis}[
		title={Throughput against input rate a},
		xlabel={Rate a},
		ylabel={Throughput},
		xmin=0, xmax=10,
		ymin=0, ymax=5,
		legend pos=north west,
		ymajorgrids=true,
		grid style=dashed,
		cycle multiindex* list={
			mark list*
				\nextlist
			cyan,brown,green,blue,red
		}
	]
	
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/ddnr/book_a.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/ddnr/book_c.csv};

	\legend{a,c}

	\end{axis}
	\end{tikzpicture}

	\begin{tikzpicture}
	\begin{axis}[
		title={Throughput against input rate a},
		xlabel={Rate a},
		ylabel={Throughput},
		xmin=0, xmax=10,
		ymin=0, ymax=5,
		legend pos=north west,
		ymajorgrids=true,
		grid style=dashed,
		cycle multiindex* list={
			mark list*
				\nextlist
			cyan,brown,green,blue,red
		}
	]
	
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/ddnr/dbsrv_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/ddnr/dbsrv_2.csv};

	\legend{dbsrv\textsubscript{1},dbsrv\textsubscript{2}}

	\end{axis}
	\end{tikzpicture}
\end{figure}

%
% ---- Distributed database with replication
%
\subsection{Distributed database with replication}

\begin{figure}
	\caption{Distributed database with replication PEPA model}
	\label{figure:pepa_ddwr_model}
	\centering
% Automatically generated by PEPA2Latex
% --begin
\begin{displaymath}
	\begin{array}{rcl}
		\mathit{a} & = & 1.0-10.0\\
		\mathit{c} & = & 1.0\\
		\mathit{d} & = & 1.0\\
		\mathit{db} & = & 5.0\\
		[0.0ex]		\mathit{Website} & \rmdef & (\mathit{book_a},\mathit{a}).\mathit{Website}+(\mathit{book_c},\mathit{c}).\mathit{Website}+(\mathit{book_d},\mathit{d}).\mathit{Website}\\
		\mathit{DB_1} & \rmdef & (\mathit{book_a},\top).\mathit{DBsrv_1}+(\mathit{book_c},\top).\mathit{DBsrv_1}\\
		\mathit{DBsrv_1} & \rmdef & (\mathit{dbsrv_1},\top).\mathit{DB_1}\\
		\mathit{DB_2} & \rmdef & (\mathit{book_c},\top).\mathit{DBsrv_2}+(\mathit{book_d},\top).\mathit{DBsrv_2}\\
		\mathit{DBsrv_2} & \rmdef & (\mathit{dbsrv_2},\top).\mathit{DB_2}\\
		\mathit{DB_3} & \rmdef & (\mathit{book_d},\top).\mathit{DBsrv_3}+(\mathit{book_a},\top).\mathit{DBsrv_3}\\
		\mathit{DBsrv_3} & \rmdef & (\mathit{dbsrv_3},\top).\mathit{DB_3}\\
		\mathit{Service_1} & \rmdef & (\mathit{dbsrv_1},\mathit{db}).\mathit{Service_1}\\
		\mathit{Service_2} & \rmdef & (\mathit{dbsrv_2},\mathit{db}).\mathit{Service_2}\\
		\mathit{Service_3} & \rmdef & (\mathit{dbsrv_3},\mathit{db}).\mathit{Service_3}\\
		[0.0ex]		\multicolumn{3}{l}{\mathit{Website}\sync{book_a,book_c,book_d}\mathit{DB_1}\parallel\mathit{DB_2}\parallel\mathit{DB_3}\sync{dbsrv_1,dbsrv_2,dbsrv_3}\mathit{Service_1}\parallel\mathit{Service_2}\parallel\mathit{Service_3}}\\
		[0.0ex]	\end{array}
\end{displaymath}
% --end
\end{figure}

See the experimental results in Table \ref{table:ddwr_results}.

\begin{table}[h!]
	\begin{center}
		\caption{Distributed database with replication experimental results}
		\label{table:ddwr_results}
		\pgfplotstabletypeset[
		col sep=comma,
		string type,
		columns/a/.style={column name=a, column type={p{.1\textwidth}}},
		columns/booka/.style={column name=book\textsubscript{a}, column type={p{.1\textwidth}}},
		columns/bookc/.style={column name=book\textsubscript{c}, column type={p{.1\textwidth}}},
		columns/bookd/.style={column name=book\textsubscript{d}, column type={p{.1\textwidth}}},
		columns/dbsrv1/.style={column name=dbsrv\textsubscript{1}, column type={p{.1\textwidth}}},
		columns/dbsrv2/.style={column name=dbsrv\textsubscript{2}, column type={p{.1\textwidth}}},
		columns/dbsrv3/.style={column name=dbsrv\textsubscript{3}, column type={p{.1\textwidth}}},
		every head row/.style={before row=\hline Rate & \multicolumn{6}{c}{Throughput} \\,after row=\hline},
		every last row/.style={after row=\hline},
		]{data/ddwr/results.csv}
	\end{center}
\end{table}

\begin{figure}
	\caption{Distributed database with replication experimental results}
	\label{figure:ddwr_charts}
	\centering
	\begin{tikzpicture}
	\begin{axis}[
		title={Throughput against input rate a},
		width=0.9\textwidth,
		ybar=0pt,
		bar width=.02\textwidth,
		xlabel={Rate a},
		ylabel={Throughput},
		xtick=data,
		ymin=0, ymax=6,
		legend pos=north west,
		ymajorgrids=true,
		grid style=dashed,
	]
	
	\addplot [pattern=north east lines, pattern color=blue] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/book_a.csv};
	\addplot [fill=green] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/book_c.csv};
	\addplot [pattern=crosshatch, pattern color=brown] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/book_d.csv};

	\legend{a,c,d}

	\end{axis}
	\end{tikzpicture}

	\begin{tikzpicture}
	\begin{axis}[
		title={Throughput against input rate a},
		width=0.9\textwidth,
		ybar=0pt,
		bar width=.02\textwidth,
		xlabel={Rate a},
		ylabel={Throughput},
		xtick=data,
		ymin=0, ymax=6,
		legend pos=north west,
		ymajorgrids=true,
		grid style=dashed,
	]
	
	\addplot [pattern=north east lines, pattern color=blue] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/dbsrv_1.csv};
	\addplot [fill=green] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/dbsrv_2.csv};
	\addplot [pattern=crosshatch, pattern color=brown] table [x index={0}, y index={1}, col sep=comma]{data/ddwr/dbsrv_3.csv};

	\legend{dbsrv\textsubscript{1},dbsrv\textsubscript{2},dbsrv\textsubscript{3}}

	\end{axis}
	\end{tikzpicture}
\end{figure}

%
% ---- Shared middleware queue
%
\subsection{Shared middleware queue}

Queues have already been extensively modelled in PEPA \cite{RN75}...

\begin{figure}
	\caption{Generic shared queue PEPA model}
	\label{figure:pepa_queue_model}
	\centering
	% Automatically generated by PEPA2Latex
	% --begin
	\begin{displaymath}
		\begin{array}{rcl}
			\mathit{a_1} & = & 1.0-10.0\\
			\mathit{s_1} & = & 5.0\\
			\mathit{a_2} & = & 1.0\\
			\mathit{s_2} & = & 5.0\\
			[0.0ex]		\mathit{Arrival_1} & \rmdef & (\mathit{arrive_1},\mathit{a_1}).\mathit{Arrival_1}\\
			\mathit{Service_1} & \rmdef & (\mathit{serve_1},\mathit{s_1}).\mathit{Service_1}\\
			\mathit{Arrival_2} & \rmdef & (\mathit{arrive_2},\mathit{a_2}).\mathit{Arrival_2}\\
			\mathit{Service_2} & \rmdef & (\mathit{serve_2},\mathit{s_2}).\mathit{Service_2}\\
			\mathit{Q_0} & \rmdef & (\mathit{arrive_1},\top).\mathit{Q_1}+(\mathit{arrive_2},\top).\mathit{Q_2}\\
			\mathit{Q_1} & \rmdef & (\mathit{serve_1},\top).\mathit{Q_0}\\
			\mathit{Q_2} & \rmdef & (\mathit{serve_2},\top).\mathit{Q_0}\\
			[0.0ex]		\multicolumn{3}{l}{\mathit{Arrival_1}\sync{arrive_1}\mathit{Q_0}[N]\sync{serve_1}\mathit{Service_1}\sync{arrive_2}\mathit{Arrival_2}\sync{serve_2}\mathit{Service_2}}\\
			[0.0ex]	\end{array}
	\end{displaymath}
	% --end
\end{figure}

\begin{figure}
	\caption{Generic shared queue experimental results}
	\label{figure:queue_charts}
	\centering
	\begin{tikzpicture}
	\begin{axis}[
		title={Throughput of arrive\textsubscript{1} against input rate a\textsubscript{1} for different queue lengths N},
		xlabel={Rate a\textsubscript{1}},
		ylabel={Throughput arrive\textsubscript{1}},
		xmin=0, xmax=10,
		ymin=0, ymax=5,
		legend pos=north west,
		ymajorgrids=true,
		grid style=dashed,
		cycle multiindex* list={
			mark list*
				\nextlist
			cyan,brown,green,blue,red
		}
	]
	
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N1_arrive_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N2_arrive_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N5_arrive_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N10_arrive_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N20_arrive_1.csv};
	
	\legend{N = 1, N = 2, N = 5, N = 10, N = 20}

	\end{axis}
	\end{tikzpicture}
	
	\begin{tikzpicture}
	\begin{axis}[
	title={Throughput of serve\textsubscript{1} against input rate a\textsubscript{1} for different queue lengths N},
	xlabel={Rate a\textsubscript{1}},
	ylabel={Throughput serve\textsubscript{1}},
	xmin=0, xmax=10,
	ymin=0, ymax=5,
	legend pos=north west,
	ymajorgrids=true,
	grid style=dashed,
	cycle multiindex* list={
		mark list*
		\nextlist
		cyan,brown,green,blue,red
	}
	]
	
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N1_serve_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N2_serve_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N5_serve_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N10_serve_1.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N20_serve_1.csv};
	
	\legend{N = 1, N = 2, N = 5, N = 10, N = 20}
	
	\end{axis}
	\end{tikzpicture}
	
	\begin{tikzpicture}
	\begin{axis}[
	title={Throughput of arrive\textsubscript{2} against input rate a\textsubscript{1} for different queue lengths N},
	xlabel={Rate a\textsubscript{1}},
	ylabel={Throughput arrive\textsubscript{2}},
	xmin=0, xmax=10,
	ymin=0, ymax=1,
	legend pos=south west,
	ymajorgrids=true,
	grid style=dashed,
	cycle multiindex* list={
		mark list*
		\nextlist
		cyan,brown,green,blue,red
	}
	]
	
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N1_arrive_2.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N2_arrive_2.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N5_arrive_2.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N10_arrive_2.csv};
	\addplot table [x index={0}, y index={1}, col sep=comma]{data/queue/N20_arrive_2.csv};
	
	\legend{N = 1, N = 2, N = 5, N = 10, N = 20}
	
	\end{axis}
	\end{tikzpicture}
\end{figure}